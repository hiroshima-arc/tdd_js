<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="ie=edge" http-equiv="X-UA-Compatible" />
    <title>Re:ゼロから始めるテスト駆動開発</title>
    <link
      href="https://cdn.rawgit.com/mochajs/mocha/2.2.5/mocha.css"
      rel="stylesheet"
    />

    <style type="text/css">
      body {
        width: 810px;
        margin: 0 auto;
        background-color: ivory;
      }
      header {
        width: 350px;
      }
      .nav-component {
        width: 290px;
        float: left;
        padding: 5px;
        margin-bottom: 5px;
      }
      .fizz-buzz-component {
        width: 500px;
        float: right;
        padding-left: 5px;
        padding-bottom: 10px;
        margin-bottom: 5px;
      }
      .fizz-buzz-component table {
        margin-top: 10px;
        border-collapse: collapse;
      }
      .fizz-buzz-component th {
        border: 1px solid black;
        background-color: aqua;
      }
      .fizz-buzz-component td {
        border: 1px solid black;
      }
      footer {
        clear: both;
        width: auto;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h1>HTML5+CSS+JavaScript with TDD</h1>
    <header>
      <nav class="nav-component">
        <h1>Menu</h1>
        <ul>
          <li><a href="readme.html" target="_blank">README</a></li>
          <li><a href="index.html">FizzBuzz</a></li>
        </ul>
      </nav>
    </header>
    <section>
      <section class="fizz-buzz-component">
        <h2>アンケート</h2>
        <div id="app">
          <form
            name="fizzBuzzForm"
            class="__form"
            method="POST"
            action="http://localhost:4000/api/survey/save"
          >
            <fieldset>
              <p class="fizz-buzz-component __form __input">
                イベント名：<input
                  id="name"
                  type="text"
                  size="30"
                  name="name"
                  textinput=""
                  class="--text"
                  value="広島フロントエンド勉強会 Vol.26"
                  readonly
                />
                <label class="--label"></label>
              </p>
              <p class="fizz-buzz-component __form __radio">
                性別：
                <input
                  type="radio"
                  name="gender"
                  id="gender1"
                  value="男性"
                  raidoinput="3"
                /><label for="gender1">男性</label>
                <input
                  type="radio"
                  name="gender"
                  id="gender2"
                  value="女性"
                  raidoinput="3"
                /><label for="gender2">女性</label>
                <input
                  type="radio"
                  name="gender"
                  id="gender3"
                  value="その他"
                /><label for="gender3">その他</label>
              </p>
              <p class="fizz-buzz-component __form __select">
                職業：<select size="1" name="job"
                  ><option value="0"> </option
                  ><option value="学生"> 学生 </option
                  ><option value="社会人"> 社会人 </option
                  ><option value="その他"> その他 </option>
                </select>
              </p>

              <p class="fizz-buzz-component __form __radio">
                内容：
                <input
                  type="radio"
                  name="impression"
                  id="impression1"
                  value="良い"
                  raidoinput="3"
                /><label for="inputRadio2-1">良かった</label>
                <input
                  type="radio"
                  name="impression"
                  id="impression2"
                  value="普通"
                  raidoinput="3"
                /><label for="inputRadio2-2">普通</label>
                <input
                  type="radio"
                  name="impression"
                  id="impression3"
                  value="悪い"
                /><label for="inputRadio2-3">悪かった</label>
              </p>
              <p class="fizz-buzz-component __form __check-box">
                きっかけ：
                <input
                  type="checkbox"
                  name="trigger"
                  id="trigger1"
                  value="SNS"
                /><label for="inputCheck1-1">SNS</label>
                <input
                  type="checkbox"
                  name="trigger"
                  id="trigger2"
                  value="検索エンジン"
                /><label for="inputCheck1-2">検索エンジン</label>
                <input
                  type="checkbox"
                  name="trigger"
                  id="trigger3"
                  value="口コミ"
                /><label for="inputCheck1-3">口コミ</label>
                <input
                  type="checkbox"
                  name="trigger"
                  id="trigger4"
                  value="その他"
                /><label for="inputCheck1-4">その他</label>
              </p>
              <p class="fizz-buzz-component __form __select">
                実施されるなら参加したいイベント：<select
                  size="1"
                  name="nextevent"
                  ><option value="0"> </option
                  ><option value="PHPから始めるテスト駆動開発">
                    PHPから始めるテスト駆動開発 </option
                  ><option value="APIサービスと連携するフロントエンド開発">
                    APIサービスと連携するフロントエンド開発</option
                  ><option value="AWSから始めるフロントエンド開発">
                    AWSから始めるフロントエンド開発 </option
                  ><option value="JavaScriptから始めるオブジェクト指向">
                    JavaScriptから始めるオブジェクト指向
                  </option></select
                >
                <label class="--label"></label>
              </p>
              <div>
                <p class="fizz-buzz-component __form __text-area">
                  その他ご意見・ご要望：<textarea
                    rows="4"
                    cols="40"
                    name="message"
                    class="__input--text-area"
                  ></textarea>
                </p>
              </div>
              <p>
                <button
                  type="button"
                  name="buttonSubmit"
                  onclick="sendSurvey()"
                >
                  送信
                </button>
              </p>
            </fieldset>
          </form>
        </div>
        <div id="mocha"></div>
      </section>
    </section>
    <footer>
      <p>Copyright</p>
      <address>hiroshima.arc@gmail.com</address>
    </footer>

    <script src="https://cdn.rawgit.com/jquery/jquery/2.1.4/dist/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/4.2.0/chai.min.js"></script>
    <script src="https://cdn.rawgit.com/mochajs/mocha/2.2.5/mocha.js"></script>
    <script>
      mocha.setup("tdd");

      const surveyData = () => {
        const genders = document.getElementsByName("gender");
        let gender;
        for (let i = 0; i < genders.length; i++) {
          if (genders[i].checked) {
            gender = genders[i].value;
            break;
          }
        }

        const impressions = document.getElementsByName("impression");
        let impression;
        for (let i = 0; i < impressions.length; i++) {
          if (impressions[i].checked) {
            impression = impressions[i].value;
            break;
          }
        }

        const triggers = document.getElementsByName("trigger");
        let trigger = [];
        for (let i = 0; i < triggers.length; i++) {
          if (triggers[i].checked) {
            trigger.push(triggers[i].value);
          }
        }

        let message = document.querySelector(
          "#app > form > fieldset > div > p > textarea"
        ).value;

        if (message === "") message = " ";

        return {
          name: document.querySelector("#name").value,
          gender: gender,
          job: document.querySelector(
            "#app > form > fieldset > p:nth-child(3) > select"
          ).value,
          impression: impression,
          trigger: trigger,
          nextevent: document.querySelector(
            "#app > form > fieldset > p:nth-child(6) > select"
          ).value,
          message: message
        };
      };

      function sendSurvey() {
        const apiUrl = "http://localhost:4000";

        const success = data => {
          console.log(data);
        };
        const errors = data => {
          console.log(data);
        };

        apiCall(`${apiUrl}/api/survey/save`, "POST", success, errors);
      }

      function apiCall(url, method, onSuccess, onErrors) {
        console.log(surveyData());
        $("#app__message").html("処理中...");
        $.ajax({
          url: url,
          type: method,
          data: surveyData()
        })
          .done(data => {
            onSuccess(data);
            const message = `<h3>Apiサーバーの読み込みに成功しました</h3>`;
            $("#app__message").html(message);
          })
          .fail(data => {
            onErrors(data);
            const message = `<h3>Apiサーバーでエラーが発生しました</h3>`;
            $("#app__message").html(message);
          });
      }
    </script>

    <script>
      mocha.checkLeaks();
      mocha.globals(["jQuery"]);
      mocha.run();
    </script>
  </body>
</html>
